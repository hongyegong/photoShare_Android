
var MyouProvince=function()
{this.provinceDom=null,this.cityDom=null,this.regionDom=null,this.onChoseProvince=null,this.onChoseCity=null,this.onChoseRegion=null;this.setProvince=function()
{this.optionAppender(MYOU_RES_PROVINCE,this.provinceDom,true,' 选择省份 ');this.optionAppender(null,this.cityDom,true,' 选择城市 ');this.optionAppender(null,this.regionDom,true,' 选择区县 ');var curCallbackRef=this.onChoseProvince,thisRef=this;this.provinceDom.onchange=function()
{thisRef.setCity(this.value);if((typeof curCallbackRef)==='function')
{curCallbackRef(thisRef.getValObj(this.value),this);}};},this.setCity=function(_pkProvince)
{var newItemArr=[];if(_pkProvince==='-1')
{this.optionAppender(null,this.cityDom,true,' 选择城市 ');}
this.optionAppender(null,this.regionDom,true,' 选择区县 ');for(var i=0;i<MYOU_RES_CITY.length;i++)
{if(MYOU_RES_CITY[i][0]==_pkProvince)
{newItemArr.push(MYOU_RES_CITY[i]);}}
this.optionAppender(newItemArr,this.cityDom,true,' 选择城市 ');var curCallbackRef=this.onChoseCity,thisRef=this;this.cityDom.onchange=function()
{thisRef.setRegion(this.value);if((typeof curCallbackRef)==='function')
{curCallbackRef(thisRef.getValObj(this.value),this);}};},this.setRegion=function(_pkCity)
{var newItemArr=[];if(_pkCity==='-1')
{return this.optionAppender(null,this.cityDom,true,' 选择城市 ');}else
{_pkCity=parseInt(_pkCity);}
for(var i=0;i<MYOU_RES_REGION.length;i++)
{if(MYOU_RES_REGION[i][0]==_pkCity)
{newItemArr.push(MYOU_RES_REGION[i]);}}
this.optionAppender(newItemArr,this.regionDom,true,' 选择区县 ');var curCallbackRef=this.onChoseRegion,thisRef=this;if((typeof curCallbackRef)==='function')
{this.regionDom.onchange=function(){curCallbackRef(thisRef.getValObj(this.value),this);};}},this.init=function(_provinceDom,_cityDom,_regionDom,_argus)
{this.provinceDom=_provinceDom;this.cityDom=_cityDom;this.regionDom=_regionDom;_argus=_argus||[];if(_argus&&(typeof _argus)==='object')
{if((typeof _argus['onChoseProvince'])==='function')
{this.onChoseProvince=_argus['onChoseProvince'];}
if((typeof _argus['onChoseCity'])==='function')
{this.onChoseCity=_argus['onChoseCity'];}
if((typeof _argus['onChoseRegion'])==='function')
{this.onChoseRegion=_argus['onChoseRegion'];}}
var isLoadRes=false,thisRef=this;var curTimeout=setInterval(function()
{if((typeof MYOU_RES_PROVINCE)!='undefined'&&(typeof MYOU_RES_CITY)!='undefined'&&(typeof MYOU_RES_REGION)!='undefined')
{clearInterval(curTimeout);curTimeout=null;delete curTimeout;thisRef.setProvince();var callback=_argus['onInit'];if(typeof callback==='function')
{callback(thisRef);}}else
{if(!isLoadRes)
{isLoadRes=true;}}},500);},this.findByPk=function(pk)
{if((typeof pk)==='string')
{pk=this.getPKByNP(pk);}
if((!pk&&pk!=0)||pk==='-1')
{this.optionAppender(null,this.cityDom,true,' 选择城市 ');this.optionAppender(null,this.regionDom,true,' 选择区县 ');return;}
pk=parseInt(pk);var pkProvince=-1,pkCity=-1,pkRegion=-1,isEnd=false;var regionArrRef=MYOU_RES_REGION;for(var i=0;i<regionArrRef.length;i++)
{if(regionArrRef[i][1]==pk)
{pkRegion=regionArrRef[i][1];break;}}
if(pkRegion!=-1)
{pk=pkCity=regionArrRef[i][0];}
var cityArrRef=MYOU_RES_CITY;for(i=0;i<cityArrRef.length;i++)
{if(cityArrRef[i][1]==pk)
{pkCity=cityArrRef[i][1];break;}}
if(pkCity!=-1)
{pk=pkProvince=cityArrRef[i][0];isEnd=true;}
if(pkProvince==-1&&isEnd==false)
{var provinceArrRef=MYOU_RES_PROVINCE;for(i=0;i<provinceArrRef.length;i++)
{if(provinceArrRef[i][0]==pk)
{pkProvince=provinceArrRef[i][0];break;}}}
this.selectItemByVal(this.provinceDom,pkProvince);this.setCity(pkProvince);this.selectItemByVal(this.cityDom,pkCity);if(pkCity!=-1)
{this.setRegion(pkCity);this.selectItemByVal(this.regionDom,pkRegion);}},this.getValObj=function(_pk)
{if((typeof _pk)==='string'&&/[^\d]/gi.test(_pk))
{_pk=this.getPKByNP(_pk);}
if((!_pk&&_pk!=0)||_pk==='-1')
{this.optionAppender(null,this.cityDom,true,' 请选择城市');this.optionAppender(null,this.regionDom,true,' 请选择区县');return;}
_pk=parseInt(_pk);var ifFindIt=false,obj=null;var regionArrRef=MYOU_RES_REGION;for(var i=0;i<regionArrRef.length;i++)
{if(regionArrRef[i][1]==_pk)
{obj=regionArrRef[i];ifFindIt=true;break;}}
var cityArrRef=MYOU_RES_CITY;for(i=0;i<cityArrRef.length&&!ifFindIt;i++)
{if(cityArrRef[i][1]==_pk)
{obj=cityArrRef[i];ifFindIt=true;break;}}
var provinceArrRef=MYOU_RES_PROVINCE;for(i=0;i<provinceArrRef.length&&!ifFindIt;i++)
{if(provinceArrRef[i][0]==_pk)
{obj=provinceArrRef[i];break;}}
return obj;},this.getPKByNP=function(_name)
{var startIndex=0;if(/^[\u4e00-\u9fa5]+$/g.test(_name))
{startIndex=2;}
else if(/[^\d]/gi.test(_name))
{startIndex=3;}
var ifFindIt=false;var regionArrRef=MYOU_RES_REGION;for(var i=0;i<regionArrRef.length;i++)
{if(regionArrRef[i][startIndex]==_name)
{_name=regionArrRef[i][1];ifFindIt=true;break;}}
var cityArrRef=MYOU_RES_CITY;for(i=0;i<cityArrRef.length&&!ifFindIt;i++)
{if(cityArrRef[i][startIndex]==_name)
{_name=cityArrRef[i][1];ifFindIt=true;break;}}
var provinceArrRef=MYOU_RES_PROVINCE;for(i=0;i<provinceArrRef.length&&!ifFindIt;i++)
{if(provinceArrRef[i][startIndex-1]==_name)
{_name=provinceArrRef[i][0];break;}}
return _name;},this.optionAppender=function(_res,_obj,_isEmptyBefore,_defalutTipMsg)
{_res=_res||[];if(_isEmptyBefore)
{_obj.innerHTML='';var tipOption=document.createElement('option');tipOption.innerHTML=(_defalutTipMsg||' 请选择 ');tipOption.value=-1;_obj.appendChild(tipOption);}
if(!_res.length||!_res[0])
{return;}
var optionTpl=document.createElement('option');var itemOption=null;var pkIndex=(_res[0].length==3)?0:1;var contIndex=pkIndex+1;for(var i=0;i<_res.length;i++){itemOption=optionTpl.cloneNode(false);itemOption.value=_res[i][pkIndex];itemOption.innerHTML=_res[i][contIndex];_obj.appendChild(itemOption);}},this.selectItemByVal=function(_selectDom,_val)
{if(!this.isValidate(_selectDom)||_val==-1)
{return;}
_val=_val+'';var allItem=_selectDom.getElementsByTagName('option');var opt=null;for(var i=0;i<allItem.length;i++)
{allItem[i].removeAttribute('selected');}
for(var i=0;i<allItem.length;i++)
{opt=allItem[i];if(opt.value===_val&&opt.tagName.toLowerCase()==='option')
{opt.setAttribute('selected','selected');break;}}},this.isValidate=function(_obj)
{if((typeof _obj)==='undefined'||(!_obj&&_obj!=0))
{return false;}else{return true;}};return this;};myou.extend({province:MyouProvince});